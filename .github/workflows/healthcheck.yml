name: Periodic healtcheck

on:
  schedule:
    - cron:  '*/5 * * * *' # TODO: reduce frequency from every 5 minutes to once a day

jobs:
  healthcheck:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3
      - name: Check the deployed service URL
        uses: jtalk/url-health-check-action@v2
        with:
          url: https://walther-pokedex.herokuapp.com/health
          follow-redirect: false
          max-attempts: 3
          retry-delay: 5s
          retry-all: false
      - name: discord webhook notify errors
        if: ${{ failure() }}
        uses: rjstone/discord-webhook-notify@v1.0.4
        with:
          severity: error
          description: "The periodic healthcheck failed."
          details: Healthcheck failed for https://walther-pokedex.herokuapp.com/
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
